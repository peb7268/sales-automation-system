<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js - Hierarchy Charts</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #333; margin-top: 30px; }
        .tooltip { position: absolute; padding: 10px; background: rgba(0, 0, 0, 0.8); color: white; border-radius: 4px; pointer-events: none; opacity: 0; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>D3.js - Hierarchy Visualizations</h1>
        <h2>Treemap - Budget Allocation</h2>
        <div id="treemap"></div>
        <h2>Sunburst - Company Structure</h2>
        <div id="sunburst"></div>
    </div>
    <div class="tooltip"></div>
    <script>
        // Treemap
        (function() {
            const width = 960, height = 500;
            const svg = d3.select('#treemap').append('svg').attr('width', width).attr('height', height);
            const tooltip = d3.select('.tooltip');

            const data = {
                name: "Budget",
                children: [
                    { name: "Engineering", value: 450000 },
                    { name: "Sales", value: 320000 },
                    { name: "Marketing", value: 280000 },
                    { name: "Operations", value: 150000 },
                    { name: "HR", value: 120000 },
                    { name: "Legal", value: 80000 }
                ]
            };

            const root = d3.hierarchy(data).sum(d => d.value).sort((a, b) => b.value - a.value);
            d3.treemap().size([width, height]).padding(1)(root);

            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const leaf = svg.selectAll('g')
                .data(root.leaves())
                .enter().append('g')
                .attr('transform', d => `translate(${d.x0},${d.y0})`);

            leaf.append('rect')
                .attr('width', d => d.x1 - d.x0)
                .attr('height', d => d.y1 - d.y0)
                .attr('fill', d => color(d.data.name))
                .on('mouseover', function(event, d) {
                    tooltip.style('opacity', 1).html(`${d.data.name}<br/>$${d.data.value.toLocaleString()}`);
                })
                .on('mousemove', function(event) {
                    tooltip.style('left', (event.pageX + 10) + 'px').style('top', (event.pageY - 10) + 'px');
                })
                .on('mouseout', function() { tooltip.style('opacity', 0); });

            leaf.append('text')
                .attr('x', 4)
                .attr('y', 20)
                .text(d => d.data.name)
                .attr('font-size', '12px')
                .attr('fill', 'white');
        })();

        // Sunburst
        (function() {
            const width = 960, height = 500, radius = Math.min(width, height) / 2;
            const svg = d3.select('#sunburst').append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${width/2},${height/2})`);
            const tooltip = d3.select('.tooltip');

            const data = {
                name: "Company",
                children: [
                    { name: "Tech", children: [
                        { name: "Frontend", value: 3000 },
                        { name: "Backend", value: 4000 },
                        { name: "DevOps", value: 2000 }
                    ]},
                    { name: "Business", children: [
                        { name: "Sales", value: 5000 },
                        { name: "Marketing", value: 3000 },
                        { name: "Support", value: 2000 }
                    ]}
                ]
            };

            const root = d3.partition().size([2 * Math.PI, radius])(d3.hierarchy(data).sum(d => d.value));
            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .innerRadius(d => d.y0)
                .outerRadius(d => d.y1);

            g.selectAll('path')
                .data(root.descendants())
                .enter().append('path')
                .attr('d', arc)
                .style('fill', d => color(d.data.name))
                .style('stroke', '#fff')
                .on('mouseover', function(event, d) {
                    tooltip.style('opacity', 1).html(`${d.data.name}<br/>Value: ${d.value || ''}`);
                })
                .on('mousemove', function(event) {
                    tooltip.style('left', (event.pageX + 10) + 'px').style('top', (event.pageY - 10) + 'px');
                })
                .on('mouseout', function() { tooltip.style('opacity', 0); });
        })();
    </script>
</body>
</html>
